{"ast":null,"code":"\"use strict\";\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.I18nDecorator = exports.I18nContextDecorator = exports.I18nContext = exports.contextTypes = exports[\"default\"] = void 0;\n\nvar _dispatcher = require(\"@enact/core/dispatcher\");\n\nvar _hoc = _interopRequireDefault(require(\"@enact/core/hoc\"));\n\nvar _util = require(\"@enact/core/util\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _locale = require(\"../locale\");\n\nvar _index = _interopRequireDefault(require(\"../src/index.js\"));\n\nvar _resBundle = require(\"../src/resBundle\");\n\nvar _wrapIlibCallback = _interopRequireDefault(require(\"../src/wrapIlibCallback\"));\n\nvar _getI18nClasses = _interopRequireDefault(require(\"./getI18nClasses\"));\n\nvar _windowFocus = require(\"./windowFocus\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar join = function join(a, b) {\n  return a && b ? a + ' ' + b : a || b || '';\n};\n\nvar contextTypes = {\n  rtl: _propTypes[\"default\"].bool,\n  updateLocale: _propTypes[\"default\"].func\n};\nexports.contextTypes = contextTypes;\n\nvar I18nContext = _react[\"default\"].createContext(null);\n/**\n * Default config for `I18nDecorator`.\n *\n * @memberof i18n/I18nDecorator.I18nDecorator\n * @hocconfig\n */\n\n\nexports.I18nContext = I18nContext;\nvar defaultConfig = {\n  /**\n   * Array of locales that should be treated as latin regardless of their script.\n   *\n   * @type {String[]}\n   * @default\tnull\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  latinLanguageOverrides: null,\n\n  /**\n   * Array of locales that should be treated as non-latin regardless of their script.\n   *\n   * @type {String[]}\n   * @default null\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  nonLatinLanguageOverrides: null,\n\n  /**\n   * Array of resource loaders to be invoked after a locale change.\n   *\n   * Each loader must be a function which accepts an object and returns either the resource when\n   * `options.sync` is `true` or a `Promise` for the resource when `options.sync` is `false`.\n   *\n   * ```\n   * resources: [\n   *   (options) => new Promise((resolve, reject) => {\n   *     fetchResource({onLoad: resolve, onError: reject});\n   *   })\n   * ]\n   * ```\n   *\n   * If you need to handle the resource in some way on load, you can pass an object with an\n   * `onLoad` member that will be called once all resources have been loaded. This should be used\n   * if loading a resource has side effects that should only be applied once all loading has\n   * completed.\n   *\n   * ```\n   * resources: [\n   *   {resource: (options) => { ... fetch ... }, onLoad: (res) => { ... apply side effect ... }}\n   * ]\n   * ```\n   *\n   * @type {Array<Function|Object>}\n   * @default null\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  resources: null,\n\n  /**\n   * Retrieve i18n resource files synchronously\n   *\n   * @type {Boolean}\n   * @default false\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  sync: false\n};\n/**\n * A higher-order component that is used to wrap the root element in an app. It provides an `rtl` member on the\n * context of the wrapped component, allowing the children to check the current text directionality as well as\n * an `updateLocale` method that can be used to update the current locale.\n *\n * There are no configurable options on this HOC.\n *\n * @class I18nDecorator\n * @memberof i18n/I18nDecorator\n * @hoc\n * @public\n */\n\nvar I18nDecorator = (0, _hoc[\"default\"])(defaultConfig, function (config, Wrapped) {\n  var _class, _temp;\n\n  var latinLanguageOverrides = config.latinLanguageOverrides,\n      nonLatinLanguageOverrides = config.nonLatinLanguageOverrides,\n      sync = config.sync; // Normalize the structure of the external resources to be an array of resource/onLoad pairs\n\n  var extResources = Array.isArray(config.resources) ? config.resources.map(function (res) {\n    if (!res) return;\n    var fn = res.resource || res;\n    var onLoad = res.onLoad;\n    if (typeof fn !== 'function') return;\n    return {\n      resource: fn,\n      onLoad: onLoad\n    };\n  }).filter(Boolean) : [];\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_React$Component) {\n    _inherits(_class, _React$Component);\n\n    function _class(props) {\n      var _this;\n\n      _classCallCheck(this, _class);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(_class).call(this, props));\n\n      _this.handleLocaleChange = function () {\n        (0, _windowFocus.onWindowFocus)(_this.updateLocale);\n      };\n\n      _this.updateLocale = function (newLocale) {\n        var state = _this.getDerivedStateForLocale(newLocale);\n\n        if (sync) {\n          _this.setState(state);\n        } else {\n          _this.loadResources(newLocale);\n\n          _this.setState({\n            resourcesLoaded: false\n          });\n        }\n      };\n\n      var ilibLocale = _index[\"default\"].getLocale();\n\n      var locale = props.locale && props.locale !== ilibLocale ? props.locale : ilibLocale;\n      _this.loadResourceJob = new _util.Job(_this.setState.bind(_assertThisInitialized(_this)));\n      _this.state = _this.getDerivedStateForLocale(locale);\n      return _this;\n    }\n\n    _createClass(_class, [{\n      key: \"getChildContext\",\n      value: function getChildContext() {\n        return {\n          rtl: this.state.rtl,\n          updateLocale: this.updateLocale\n        };\n      }\n    }, {\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object') {\n          (0, _dispatcher.on)('languagechange', this.handleLocaleChange, window);\n        }\n\n        if (!sync) {\n          this.loadResources(this.state.locale);\n        }\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate(prevProps) {\n        if (this.props.locale !== prevProps.locale) {\n          var state = this.getDerivedStateForLocale(this.props.locale);\n\n          if (sync) {\n            // eslint-disable-next-line react/no-did-update-set-state\n            this.setState(state);\n          } else {\n            this.loadResources(this.props.locale);\n          }\n        }\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        this.loadResourceJob.stop();\n\n        if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object') {\n          (0, _dispatcher.off)('languagechange', this.handleLocaleChange, window);\n        }\n      }\n    }, {\n      key: \"getDerivedStateForLocale\",\n      value: function getDerivedStateForLocale(spec) {\n        var locale = (0, _locale.updateLocale)(spec);\n        var state = {\n          locale: locale,\n          resourcesLoaded: sync\n        };\n\n        if (sync) {\n          var options = {\n            locale: locale,\n            sync: sync\n          };\n          state.rtl = (0, _wrapIlibCallback[\"default\"])(_locale.isRtlLocale, options);\n          state.classes = (0, _wrapIlibCallback[\"default\"])(_getI18nClasses[\"default\"], _objectSpread({}, options, {\n            latinLanguageOverrides: latinLanguageOverrides,\n            nonLatinLanguageOverrides: nonLatinLanguageOverrides\n          }));\n          var bundle = (0, _wrapIlibCallback[\"default\"])(_resBundle.createResBundle, options);\n          (0, _resBundle.setResBundle)(bundle);\n          extResources.forEach(function (_ref) {\n            var resource = _ref.resource,\n                onLoad = _ref.onLoad;\n            var result = resource(options);\n            if (onLoad) onLoad(result);\n          });\n        }\n\n        return state;\n      }\n    }, {\n      key: \"loadResources\",\n      value: function loadResources(locale) {\n        var options = {\n          sync: sync,\n          locale: locale\n        };\n        var resources = Promise.all([(0, _wrapIlibCallback[\"default\"])(_locale.isRtlLocale, options), (0, _wrapIlibCallback[\"default\"])(_getI18nClasses[\"default\"], _objectSpread({}, options, {\n          latinLanguageOverrides: latinLanguageOverrides,\n          nonLatinLanguageOverrides: nonLatinLanguageOverrides\n        })), // move updating into a new method with call to setState\n        (0, _wrapIlibCallback[\"default\"])(_resBundle.createResBundle, options)].concat(_toConsumableArray(extResources.map(function (res) {\n          return (0, _wrapIlibCallback[\"default\"])(res.resource, options);\n        })))).then(function (_ref2) {\n          var _ref3 = _toArray(_ref2),\n              rtl = _ref3[0],\n              classes = _ref3[1],\n              bundle = _ref3[2],\n              userResources = _ref3.slice(3);\n\n          (0, _resBundle.setResBundle)(bundle);\n          extResources.forEach(function (_ref4, i) {\n            var onLoad = _ref4.onLoad;\n            return onLoad && onLoad(userResources[i]);\n          });\n          return {\n            locale: locale,\n            classes: classes,\n            rtl: rtl,\n            resourcesLoaded: true\n          };\n        }); // TODO: Resolve how to handle failed resource resquests\n        // .catch(...);\n\n        this.loadResourceJob.promise(resources);\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var props = Object.assign({}, this.props);\n        delete props.locale;\n        props.className = join(this.state.classes, this.props.className);\n        var value = {\n          locale: this.state.locale,\n          rtl: this.state.rtl,\n          loaded: this.state.resourcesLoaded,\n          updateLocale: this.updateLocale\n        };\n        return _react[\"default\"].createElement(I18nContext.Provider, {\n          value: value\n        }, _react[\"default\"].createElement(Wrapped, props));\n      }\n    }]);\n\n    return _class;\n  }(_react[\"default\"].Component), _class.displayName = 'I18nDecorator', _class.propTypes =\n  /** @lends i18n/I18nDecorator.I18nDecorator.prototype */\n  {\n    /**\n     * Classname for a root app element.\n     *\n     * @type {String}\n     * @public\n     */\n    className: _propTypes[\"default\"].string,\n\n    /**\n     * A string with a {@link https://tools.ietf.org/html/rfc5646|BCP 47 language tag}.\n     *\n     * The system locale will be used by default.\n     *\n     * @type {String}\n     * @public\n     */\n    locale: _propTypes[\"default\"].string\n  }, _class.childContextTypes = contextTypes, _temp;\n});\nexports.I18nDecorator = I18nDecorator;\nvar contextDefaultConfig = {\n  localeProp: null,\n  rtlProp: null,\n  updateLocaleProp: null\n};\nvar I18nContextDecorator = (0, _hoc[\"default\"])(contextDefaultConfig, function (config, Wrapped) {\n  var loadedProp = config.loadedProp,\n      localeProp = config.localeProp,\n      rtlProp = config.rtlProp,\n      updateLocaleProp = config.updateLocaleProp; // eslint-disable-next-line no-shadow\n\n  return function I18nContextDecorator(props) {\n    return _react[\"default\"].createElement(I18nContext.Consumer, null, function (i18nContext) {\n      if (i18nContext) {\n        var loaded = i18nContext.loaded,\n            locale = i18nContext.locale,\n            rtl = i18nContext.rtl,\n            update = i18nContext.updateLocale;\n        props = Object.assign({}, props);\n\n        if (loadedProp) {\n          props[loadedProp] = loaded;\n        }\n\n        if (localeProp) {\n          props[localeProp] = locale;\n        }\n\n        if (rtlProp) {\n          props[rtlProp] = rtl;\n        }\n\n        if (updateLocaleProp) {\n          props[updateLocaleProp] = update;\n        }\n      }\n\n      return _react[\"default\"].createElement(Wrapped, props);\n    });\n  };\n});\nexports.I18nContextDecorator = I18nContextDecorator;\nvar _default = I18nDecorator;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["F:\\books\\vscode\\enact\\final\\SteApp\\node_modules\\@enact\\i18n\\I18nDecorator\\I18nDecorator.js"],"names":["Object","defineProperty","exports","value","I18nDecorator","I18nContextDecorator","I18nContext","contextTypes","_dispatcher","require","_hoc","_interopRequireDefault","_util","_propTypes","_react","_locale","_index","_resBundle","_wrapIlibCallback","_getI18nClasses","_windowFocus","obj","__esModule","_toArray","arr","_arrayWithHoles","_iterableToArray","_nonIterableRest","TypeError","Array","isArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","iter","Symbol","iterator","prototype","toString","call","from","i","arr2","length","_objectSpread","target","arguments","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","configurable","writable","_typeof","constructor","_classCallCheck","instance","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_possibleConstructorReturn","self","_assertThisInitialized","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","ReferenceError","_inherits","subClass","superClass","create","_setPrototypeOf","p","join","a","b","rtl","bool","updateLocale","func","createContext","defaultConfig","latinLanguageOverrides","nonLatinLanguageOverrides","resources","sync","config","Wrapped","_class","_temp","extResources","map","res","fn","resource","onLoad","Boolean","_React$Component","_this","handleLocaleChange","onWindowFocus","newLocale","state","getDerivedStateForLocale","setState","loadResources","resourcesLoaded","ilibLocale","getLocale","locale","loadResourceJob","Job","bind","getChildContext","componentDidMount","window","on","componentDidUpdate","prevProps","componentWillUnmount","stop","off","spec","options","isRtlLocale","classes","bundle","createResBundle","setResBundle","_ref","result","Promise","all","then","_ref2","_ref3","userResources","slice","_ref4","promise","render","assign","className","loaded","createElement","Provider","Component","displayName","propTypes","string","childContextTypes","contextDefaultConfig","localeProp","rtlProp","updateLocaleProp","loadedProp","Consumer","i18nContext","update","_default"],"mappings":"AAAA;;;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,aAAR,GAAwBF,OAAO,CAACG,oBAAR,GAA+BH,OAAO,CAACI,WAAR,GAAsBJ,OAAO,CAACK,YAAR,GAAuBL,OAAO,CAAC,SAAD,CAAP,GAAqB,KAAK,CAA9H;;AAEA,IAAIM,WAAW,GAAGC,OAAO,CAAC,wBAAD,CAAzB;;AAEA,IAAIC,IAAI,GAAGC,sBAAsB,CAACF,OAAO,CAAC,iBAAD,CAAR,CAAjC;;AAEA,IAAIG,KAAK,GAAGH,OAAO,CAAC,kBAAD,CAAnB;;AAEA,IAAII,UAAU,GAAGF,sBAAsB,CAACF,OAAO,CAAC,YAAD,CAAR,CAAvC;;AAEA,IAAIK,MAAM,GAAGH,sBAAsB,CAACF,OAAO,CAAC,OAAD,CAAR,CAAnC;;AAEA,IAAIM,OAAO,GAAGN,OAAO,CAAC,WAAD,CAArB;;AAEA,IAAIO,MAAM,GAAGL,sBAAsB,CAACF,OAAO,CAAC,iBAAD,CAAR,CAAnC;;AAEA,IAAIQ,UAAU,GAAGR,OAAO,CAAC,kBAAD,CAAxB;;AAEA,IAAIS,iBAAiB,GAAGP,sBAAsB,CAACF,OAAO,CAAC,yBAAD,CAAR,CAA9C;;AAEA,IAAIU,eAAe,GAAGR,sBAAsB,CAACF,OAAO,CAAC,kBAAD,CAAR,CAA5C;;AAEA,IAAIW,YAAY,GAAGX,OAAO,CAAC,eAAD,CAA1B;;AAEA,SAASE,sBAAT,CAAgCU,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAE,eAAWA;AAAb,GAArC;AAA0D;;AAEjG,SAASE,QAAT,CAAkBC,GAAlB,EAAuB;AAAE,SAAOC,eAAe,CAACD,GAAD,CAAf,IAAwBE,gBAAgB,CAACF,GAAD,CAAxC,IAAiDG,gBAAgB,EAAxE;AAA6E;;AAEtG,SAASA,gBAAT,GAA4B;AAAE,QAAM,IAAIC,SAAJ,CAAc,sDAAd,CAAN;AAA8E;;AAE5G,SAASH,eAAT,CAAyBD,GAAzB,EAA8B;AAAE,MAAIK,KAAK,CAACC,OAAN,CAAcN,GAAd,CAAJ,EAAwB,OAAOA,GAAP;AAAa;;AAErE,SAASO,kBAAT,CAA4BP,GAA5B,EAAiC;AAAE,SAAOQ,kBAAkB,CAACR,GAAD,CAAlB,IAA2BE,gBAAgB,CAACF,GAAD,CAA3C,IAAoDS,kBAAkB,EAA7E;AAAkF;;AAErH,SAASA,kBAAT,GAA8B;AAAE,QAAM,IAAIL,SAAJ,CAAc,iDAAd,CAAN;AAAyE;;AAEzG,SAASF,gBAAT,CAA0BQ,IAA1B,EAAgC;AAAE,MAAIC,MAAM,CAACC,QAAP,IAAmBpC,MAAM,CAACkC,IAAD,CAAzB,IAAmClC,MAAM,CAACqC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BL,IAA/B,MAAyC,oBAAhF,EAAsG,OAAOL,KAAK,CAACW,IAAN,CAAWN,IAAX,CAAP;AAA0B;;AAElK,SAASF,kBAAT,CAA4BR,GAA5B,EAAiC;AAAE,MAAIK,KAAK,CAACC,OAAN,CAAcN,GAAd,CAAJ,EAAwB;AAAE,SAAK,IAAIiB,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG,IAAIb,KAAJ,CAAUL,GAAG,CAACmB,MAAd,CAAvB,EAA8CF,CAAC,GAAGjB,GAAG,CAACmB,MAAtD,EAA8DF,CAAC,EAA/D,EAAmE;AAAEC,MAAAA,IAAI,CAACD,CAAD,CAAJ,GAAUjB,GAAG,CAACiB,CAAD,CAAb;AAAmB;;AAAC,WAAOC,IAAP;AAAc;AAAE;;AAEtK,SAASE,aAAT,CAAuBC,MAAvB,EAA+B;AAAE,OAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,SAAS,CAACH,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIM,MAAM,GAAGD,SAAS,CAACL,CAAD,CAAT,IAAgB,IAAhB,GAAuBK,SAAS,CAACL,CAAD,CAAhC,GAAsC,EAAnD;AAAuD,QAAIO,OAAO,GAAGhD,MAAM,CAACiD,IAAP,CAAYF,MAAZ,CAAd;;AAAmC,QAAI,OAAO/C,MAAM,CAACkD,qBAAd,KAAwC,UAA5C,EAAwD;AAAEF,MAAAA,OAAO,GAAGA,OAAO,CAACG,MAAR,CAAenD,MAAM,CAACkD,qBAAP,CAA6BH,MAA7B,EAAqCK,MAArC,CAA4C,UAAUC,GAAV,EAAe;AAAE,eAAOrD,MAAM,CAACsD,wBAAP,CAAgCP,MAAhC,EAAwCM,GAAxC,EAA6CE,UAApD;AAAiE,OAA9H,CAAf,CAAV;AAA4J;;AAACP,IAAAA,OAAO,CAACQ,OAAR,CAAgB,UAAUC,GAAV,EAAe;AAAEC,MAAAA,eAAe,CAACb,MAAD,EAASY,GAAT,EAAcV,MAAM,CAACU,GAAD,CAApB,CAAf;AAA4C,KAA7E;AAAiF;;AAAC,SAAOZ,MAAP;AAAgB;;AAEje,SAASa,eAAT,CAAyBrC,GAAzB,EAA8BoC,GAA9B,EAAmCtD,KAAnC,EAA0C;AAAE,MAAIsD,GAAG,IAAIpC,GAAX,EAAgB;AAAErB,IAAAA,MAAM,CAACC,cAAP,CAAsBoB,GAAtB,EAA2BoC,GAA3B,EAAgC;AAAEtD,MAAAA,KAAK,EAAEA,KAAT;AAAgBoD,MAAAA,UAAU,EAAE,IAA5B;AAAkCI,MAAAA,YAAY,EAAE,IAAhD;AAAsDC,MAAAA,QAAQ,EAAE;AAAhE,KAAhC;AAA0G,GAA5H,MAAkI;AAAEvC,IAAAA,GAAG,CAACoC,GAAD,CAAH,GAAWtD,KAAX;AAAmB;;AAAC,SAAOkB,GAAP;AAAa;;AAEjN,SAASwC,OAAT,CAAiBxC,GAAjB,EAAsB;AAAE,MAAI,OAAOc,MAAP,KAAkB,UAAlB,IAAgC,SAAOA,MAAM,CAACC,QAAd,MAA2B,QAA/D,EAAyE;AAAEyB,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBxC,GAAjB,EAAsB;AAAE,sBAAcA,GAAd;AAAoB,KAAtD;AAAyD,GAApI,MAA0I;AAAEwC,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBxC,GAAjB,EAAsB;AAAE,aAAOA,GAAG,IAAI,OAAOc,MAAP,KAAkB,UAAzB,IAAuCd,GAAG,CAACyC,WAAJ,KAAoB3B,MAA3D,IAAqEd,GAAG,KAAKc,MAAM,CAACE,SAApF,GAAgG,QAAhG,YAAkHhB,GAAlH,CAAP;AAA+H,KAAjK;AAAoK;;AAAC,SAAOwC,OAAO,CAACxC,GAAD,CAAd;AAAsB;;AAE/V,SAAS0C,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIrC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASsC,iBAAT,CAA2BrB,MAA3B,EAAmCsB,KAAnC,EAA0C;AAAE,OAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0B,KAAK,CAACxB,MAA1B,EAAkCF,CAAC,EAAnC,EAAuC;AAAE,QAAI2B,UAAU,GAAGD,KAAK,CAAC1B,CAAD,CAAtB;AAA2B2B,IAAAA,UAAU,CAACb,UAAX,GAAwBa,UAAU,CAACb,UAAX,IAAyB,KAAjD;AAAwDa,IAAAA,UAAU,CAACT,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWS,UAAf,EAA2BA,UAAU,CAACR,QAAX,GAAsB,IAAtB;AAA4B5D,IAAAA,MAAM,CAACC,cAAP,CAAsB4C,MAAtB,EAA8BuB,UAAU,CAACX,GAAzC,EAA8CW,UAA9C;AAA4D;AAAE;;AAE7T,SAASC,YAAT,CAAsBJ,WAAtB,EAAmCK,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBJ,iBAAiB,CAACD,WAAW,CAAC5B,SAAb,EAAwBiC,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBL,iBAAiB,CAACD,WAAD,EAAcM,WAAd,CAAjB;AAA6C,SAAON,WAAP;AAAqB;;AAEvN,SAASO,0BAAT,CAAoCC,IAApC,EAA0ClC,IAA1C,EAAgD;AAAE,MAAIA,IAAI,KAAKsB,OAAO,CAACtB,IAAD,CAAP,KAAkB,QAAlB,IAA8B,OAAOA,IAAP,KAAgB,UAAnD,CAAR,EAAwE;AAAE,WAAOA,IAAP;AAAc;;AAAC,SAAOmC,sBAAsB,CAACD,IAAD,CAA7B;AAAsC;;AAEjL,SAASE,eAAT,CAAyBC,CAAzB,EAA4B;AAAED,EAAAA,eAAe,GAAG3E,MAAM,CAAC6E,cAAP,GAAwB7E,MAAM,CAAC8E,cAA/B,GAAgD,SAASH,eAAT,CAAyBC,CAAzB,EAA4B;AAAE,WAAOA,CAAC,CAACG,SAAF,IAAe/E,MAAM,CAAC8E,cAAP,CAAsBF,CAAtB,CAAtB;AAAiD,GAAjJ;AAAmJ,SAAOD,eAAe,CAACC,CAAD,CAAtB;AAA4B;;AAE7M,SAASF,sBAAT,CAAgCD,IAAhC,EAAsC;AAAE,MAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;AAAE,UAAM,IAAIO,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOP,IAAP;AAAc;;AAEtK,SAASQ,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIvD,SAAJ,CAAc,oDAAd,CAAN;AAA4E;;AAACsD,EAAAA,QAAQ,CAAC7C,SAAT,GAAqBrC,MAAM,CAACoF,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAAC9C,SAAvC,EAAkD;AAAEyB,IAAAA,WAAW,EAAE;AAAE3D,MAAAA,KAAK,EAAE+E,QAAT;AAAmBtB,MAAAA,QAAQ,EAAE,IAA7B;AAAmCD,MAAAA,YAAY,EAAE;AAAjD;AAAf,GAAlD,CAArB;AAAkJ,MAAIwB,UAAJ,EAAgBE,eAAe,CAACH,QAAD,EAAWC,UAAX,CAAf;AAAwC;;AAEjY,SAASE,eAAT,CAAyBT,CAAzB,EAA4BU,CAA5B,EAA+B;AAAED,EAAAA,eAAe,GAAGrF,MAAM,CAAC6E,cAAP,IAAyB,SAASQ,eAAT,CAAyBT,CAAzB,EAA4BU,CAA5B,EAA+B;AAAEV,IAAAA,CAAC,CAACG,SAAF,GAAcO,CAAd;AAAiB,WAAOV,CAAP;AAAW,GAAxG;;AAA0G,SAAOS,eAAe,CAACT,CAAD,EAAIU,CAAJ,CAAtB;AAA+B;;AAE1K,IAAIC,IAAI,GAAG,SAASA,IAAT,CAAcC,CAAd,EAAiBC,CAAjB,EAAoB;AAC7B,SAAOD,CAAC,IAAIC,CAAL,GAASD,CAAC,GAAG,GAAJ,GAAUC,CAAnB,GAAuBD,CAAC,IAAIC,CAAL,IAAU,EAAxC;AACD,CAFD;;AAIA,IAAIlF,YAAY,GAAG;AACjBmF,EAAAA,GAAG,EAAE7E,UAAU,CAAC,SAAD,CAAV,CAAsB8E,IADV;AAEjBC,EAAAA,YAAY,EAAE/E,UAAU,CAAC,SAAD,CAAV,CAAsBgF;AAFnB,CAAnB;AAIA3F,OAAO,CAACK,YAAR,GAAuBA,YAAvB;;AAEA,IAAID,WAAW,GAAGQ,MAAM,CAAC,SAAD,CAAN,CAAkBgF,aAAlB,CAAgC,IAAhC,CAAlB;AACA;;;;;;;;AAQA5F,OAAO,CAACI,WAAR,GAAsBA,WAAtB;AACA,IAAIyF,aAAa,GAAG;AAClB;;;;;;;;AAQAC,EAAAA,sBAAsB,EAAE,IATN;;AAWlB;;;;;;;;AAQAC,EAAAA,yBAAyB,EAAE,IAnBT;;AAqBlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BAC,EAAAA,SAAS,EAAE,IAnDO;;AAqDlB;;;;;;;;AAQAC,EAAAA,IAAI,EAAE;AA7DY,CAApB;AA+DA;;;;;;;;;;;;;AAaA,IAAI/F,aAAa,GAAG,CAAC,GAAGM,IAAI,CAAC,SAAD,CAAR,EAAqBqF,aAArB,EAAoC,UAAUK,MAAV,EAAkBC,OAAlB,EAA2B;AACjF,MAAIC,MAAJ,EAAYC,KAAZ;;AAEA,MAAIP,sBAAsB,GAAGI,MAAM,CAACJ,sBAApC;AAAA,MACIC,yBAAyB,GAAGG,MAAM,CAACH,yBADvC;AAAA,MAEIE,IAAI,GAAGC,MAAM,CAACD,IAFlB,CAHiF,CAKzD;;AAExB,MAAIK,YAAY,GAAG3E,KAAK,CAACC,OAAN,CAAcsE,MAAM,CAACF,SAArB,IAAkCE,MAAM,CAACF,SAAP,CAAiBO,GAAjB,CAAqB,UAAUC,GAAV,EAAe;AACvF,QAAI,CAACA,GAAL,EAAU;AACV,QAAIC,EAAE,GAAGD,GAAG,CAACE,QAAJ,IAAgBF,GAAzB;AACA,QAAIG,MAAM,GAAGH,GAAG,CAACG,MAAjB;AACA,QAAI,OAAOF,EAAP,KAAc,UAAlB,EAA8B;AAC9B,WAAO;AACLC,MAAAA,QAAQ,EAAED,EADL;AAELE,MAAAA,MAAM,EAAEA;AAFH,KAAP;AAID,GAToD,EASlDzD,MATkD,CAS3C0D,OAT2C,CAAlC,GASE,EATrB;AAUA,SAAOP,KAAK,GAAGD,MAAM;AACrB;AACA,YAAUS,gBAAV,EAA4B;AAC1B9B,IAAAA,SAAS,CAACqB,MAAD,EAASS,gBAAT,CAAT;;AAEA,aAAST,MAAT,CAAgBnC,KAAhB,EAAuB;AACrB,UAAI6C,KAAJ;;AAEAjD,MAAAA,eAAe,CAAC,IAAD,EAAOuC,MAAP,CAAf;;AAEAU,MAAAA,KAAK,GAAGxC,0BAA0B,CAAC,IAAD,EAAOG,eAAe,CAAC2B,MAAD,CAAf,CAAwB/D,IAAxB,CAA6B,IAA7B,EAAmC4B,KAAnC,CAAP,CAAlC;;AAEA6C,MAAAA,KAAK,CAACC,kBAAN,GAA2B,YAAY;AACrC,SAAC,GAAG7F,YAAY,CAAC8F,aAAjB,EAAgCF,KAAK,CAACpB,YAAtC;AACD,OAFD;;AAIAoB,MAAAA,KAAK,CAACpB,YAAN,GAAqB,UAAUuB,SAAV,EAAqB;AACxC,YAAIC,KAAK,GAAGJ,KAAK,CAACK,wBAAN,CAA+BF,SAA/B,CAAZ;;AAEA,YAAIhB,IAAJ,EAAU;AACRa,UAAAA,KAAK,CAACM,QAAN,CAAeF,KAAf;AACD,SAFD,MAEO;AACLJ,UAAAA,KAAK,CAACO,aAAN,CAAoBJ,SAApB;;AAEAH,UAAAA,KAAK,CAACM,QAAN,CAAe;AACbE,YAAAA,eAAe,EAAE;AADJ,WAAf;AAGD;AACF,OAZD;;AAcA,UAAIC,UAAU,GAAGzG,MAAM,CAAC,SAAD,CAAN,CAAkB0G,SAAlB,EAAjB;;AAEA,UAAIC,MAAM,GAAGxD,KAAK,CAACwD,MAAN,IAAgBxD,KAAK,CAACwD,MAAN,KAAiBF,UAAjC,GAA8CtD,KAAK,CAACwD,MAApD,GAA6DF,UAA1E;AACAT,MAAAA,KAAK,CAACY,eAAN,GAAwB,IAAIhH,KAAK,CAACiH,GAAV,CAAcb,KAAK,CAACM,QAAN,CAAeQ,IAAf,CAAoBpD,sBAAsB,CAACsC,KAAD,CAA1C,CAAd,CAAxB;AACAA,MAAAA,KAAK,CAACI,KAAN,GAAcJ,KAAK,CAACK,wBAAN,CAA+BM,MAA/B,CAAd;AACA,aAAOX,KAAP;AACD;;AAED3C,IAAAA,YAAY,CAACiC,MAAD,EAAS,CAAC;AACpB7C,MAAAA,GAAG,EAAE,iBADe;AAEpBtD,MAAAA,KAAK,EAAE,SAAS4H,eAAT,GAA2B;AAChC,eAAO;AACLrC,UAAAA,GAAG,EAAE,KAAK0B,KAAL,CAAW1B,GADX;AAELE,UAAAA,YAAY,EAAE,KAAKA;AAFd,SAAP;AAID;AAPmB,KAAD,EAQlB;AACDnC,MAAAA,GAAG,EAAE,mBADJ;AAEDtD,MAAAA,KAAK,EAAE,SAAS6H,iBAAT,GAA6B;AAClC,YAAI,CAAC,OAAOC,MAAP,KAAkB,WAAlB,GAAgC,WAAhC,GAA8CpE,OAAO,CAACoE,MAAD,CAAtD,MAAoE,QAAxE,EAAkF;AAChF,WAAC,GAAGzH,WAAW,CAAC0H,EAAhB,EAAoB,gBAApB,EAAsC,KAAKjB,kBAA3C,EAA+DgB,MAA/D;AACD;;AAED,YAAI,CAAC9B,IAAL,EAAW;AACT,eAAKoB,aAAL,CAAmB,KAAKH,KAAL,CAAWO,MAA9B;AACD;AACF;AAVA,KARkB,EAmBlB;AACDlE,MAAAA,GAAG,EAAE,oBADJ;AAEDtD,MAAAA,KAAK,EAAE,SAASgI,kBAAT,CAA4BC,SAA5B,EAAuC;AAC5C,YAAI,KAAKjE,KAAL,CAAWwD,MAAX,KAAsBS,SAAS,CAACT,MAApC,EAA4C;AAC1C,cAAIP,KAAK,GAAG,KAAKC,wBAAL,CAA8B,KAAKlD,KAAL,CAAWwD,MAAzC,CAAZ;;AAEA,cAAIxB,IAAJ,EAAU;AACR;AACA,iBAAKmB,QAAL,CAAcF,KAAd;AACD,WAHD,MAGO;AACL,iBAAKG,aAAL,CAAmB,KAAKpD,KAAL,CAAWwD,MAA9B;AACD;AACF;AACF;AAbA,KAnBkB,EAiClB;AACDlE,MAAAA,GAAG,EAAE,sBADJ;AAEDtD,MAAAA,KAAK,EAAE,SAASkI,oBAAT,GAAgC;AACrC,aAAKT,eAAL,CAAqBU,IAArB;;AAEA,YAAI,CAAC,OAAOL,MAAP,KAAkB,WAAlB,GAAgC,WAAhC,GAA8CpE,OAAO,CAACoE,MAAD,CAAtD,MAAoE,QAAxE,EAAkF;AAChF,WAAC,GAAGzH,WAAW,CAAC+H,GAAhB,EAAqB,gBAArB,EAAuC,KAAKtB,kBAA5C,EAAgEgB,MAAhE;AACD;AACF;AARA,KAjCkB,EA0ClB;AACDxE,MAAAA,GAAG,EAAE,0BADJ;AAEDtD,MAAAA,KAAK,EAAE,SAASkH,wBAAT,CAAkCmB,IAAlC,EAAwC;AAC7C,YAAIb,MAAM,GAAG,CAAC,GAAG5G,OAAO,CAAC6E,YAAZ,EAA0B4C,IAA1B,CAAb;AACA,YAAIpB,KAAK,GAAG;AACVO,UAAAA,MAAM,EAAEA,MADE;AAEVH,UAAAA,eAAe,EAAErB;AAFP,SAAZ;;AAKA,YAAIA,IAAJ,EAAU;AACR,cAAIsC,OAAO,GAAG;AACZd,YAAAA,MAAM,EAAEA,MADI;AAEZxB,YAAAA,IAAI,EAAEA;AAFM,WAAd;AAIAiB,UAAAA,KAAK,CAAC1B,GAAN,GAAY,CAAC,GAAGxE,iBAAiB,CAAC,SAAD,CAArB,EAAkCH,OAAO,CAAC2H,WAA1C,EAAuDD,OAAvD,CAAZ;AACArB,UAAAA,KAAK,CAACuB,OAAN,GAAgB,CAAC,GAAGzH,iBAAiB,CAAC,SAAD,CAArB,EAAkCC,eAAe,CAAC,SAAD,CAAjD,EAA8DyB,aAAa,CAAC,EAAD,EAAK6F,OAAL,EAAc;AACvGzC,YAAAA,sBAAsB,EAAEA,sBAD+E;AAEvGC,YAAAA,yBAAyB,EAAEA;AAF4E,WAAd,CAA3E,CAAhB;AAIA,cAAI2C,MAAM,GAAG,CAAC,GAAG1H,iBAAiB,CAAC,SAAD,CAArB,EAAkCD,UAAU,CAAC4H,eAA7C,EAA8DJ,OAA9D,CAAb;AACA,WAAC,GAAGxH,UAAU,CAAC6H,YAAf,EAA6BF,MAA7B;AACApC,UAAAA,YAAY,CAAChD,OAAb,CAAqB,UAAUuF,IAAV,EAAgB;AACnC,gBAAInC,QAAQ,GAAGmC,IAAI,CAACnC,QAApB;AAAA,gBACIC,MAAM,GAAGkC,IAAI,CAAClC,MADlB;AAEA,gBAAImC,MAAM,GAAGpC,QAAQ,CAAC6B,OAAD,CAArB;AACA,gBAAI5B,MAAJ,EAAYA,MAAM,CAACmC,MAAD,CAAN;AACb,WALD;AAMD;;AAED,eAAO5B,KAAP;AACD;AA9BA,KA1CkB,EAyElB;AACD3D,MAAAA,GAAG,EAAE,eADJ;AAEDtD,MAAAA,KAAK,EAAE,SAASoH,aAAT,CAAuBI,MAAvB,EAA+B;AACpC,YAAIc,OAAO,GAAG;AACZtC,UAAAA,IAAI,EAAEA,IADM;AAEZwB,UAAAA,MAAM,EAAEA;AAFI,SAAd;AAIA,YAAIzB,SAAS,GAAG+C,OAAO,CAACC,GAAR,CAAY,CAAC,CAAC,GAAGhI,iBAAiB,CAAC,SAAD,CAArB,EAAkCH,OAAO,CAAC2H,WAA1C,EAAuDD,OAAvD,CAAD,EAAkE,CAAC,GAAGvH,iBAAiB,CAAC,SAAD,CAArB,EAAkCC,eAAe,CAAC,SAAD,CAAjD,EAA8DyB,aAAa,CAAC,EAAD,EAAK6F,OAAL,EAAc;AACrLzC,UAAAA,sBAAsB,EAAEA,sBAD6J;AAErLC,UAAAA,yBAAyB,EAAEA;AAF0J,SAAd,CAA3E,CAAlE,EAGvB;AACL,SAAC,GAAG/E,iBAAiB,CAAC,SAAD,CAArB,EAAkCD,UAAU,CAAC4H,eAA7C,EAA8DJ,OAA9D,CAJ4B,EAI4CtF,MAJ5C,CAImDpB,kBAAkB,CAACyE,YAAY,CAACC,GAAb,CAAiB,UAAUC,GAAV,EAAe;AAChI,iBAAO,CAAC,GAAGxF,iBAAiB,CAAC,SAAD,CAArB,EAAkCwF,GAAG,CAACE,QAAtC,EAAgD6B,OAAhD,CAAP;AACD,SAFiG,CAAD,CAJrE,CAAZ,EAMVU,IANU,CAML,UAAUC,KAAV,EAAiB;AAC1B,cAAIC,KAAK,GAAG9H,QAAQ,CAAC6H,KAAD,CAApB;AAAA,cACI1D,GAAG,GAAG2D,KAAK,CAAC,CAAD,CADf;AAAA,cAEIV,OAAO,GAAGU,KAAK,CAAC,CAAD,CAFnB;AAAA,cAGIT,MAAM,GAAGS,KAAK,CAAC,CAAD,CAHlB;AAAA,cAIIC,aAAa,GAAGD,KAAK,CAACE,KAAN,CAAY,CAAZ,CAJpB;;AAMA,WAAC,GAAGtI,UAAU,CAAC6H,YAAf,EAA6BF,MAA7B;AACApC,UAAAA,YAAY,CAAChD,OAAb,CAAqB,UAAUgG,KAAV,EAAiB/G,CAAjB,EAAoB;AACvC,gBAAIoE,MAAM,GAAG2C,KAAK,CAAC3C,MAAnB;AACA,mBAAOA,MAAM,IAAIA,MAAM,CAACyC,aAAa,CAAC7G,CAAD,CAAd,CAAvB;AACD,WAHD;AAIA,iBAAO;AACLkF,YAAAA,MAAM,EAAEA,MADH;AAELgB,YAAAA,OAAO,EAAEA,OAFJ;AAGLjD,YAAAA,GAAG,EAAEA,GAHA;AAIL8B,YAAAA,eAAe,EAAE;AAJZ,WAAP;AAMD,SAxBe,CAAhB,CALoC,CA6BhC;AACJ;;AAEA,aAAKI,eAAL,CAAqB6B,OAArB,CAA6BvD,SAA7B;AACD;AAnCA,KAzEkB,EA6GlB;AACDzC,MAAAA,GAAG,EAAE,QADJ;AAEDtD,MAAAA,KAAK,EAAE,SAASuJ,MAAT,GAAkB;AACvB,YAAIvF,KAAK,GAAGnE,MAAM,CAAC2J,MAAP,CAAc,EAAd,EAAkB,KAAKxF,KAAvB,CAAZ;AACA,eAAOA,KAAK,CAACwD,MAAb;AACAxD,QAAAA,KAAK,CAACyF,SAAN,GAAkBrE,IAAI,CAAC,KAAK6B,KAAL,CAAWuB,OAAZ,EAAqB,KAAKxE,KAAL,CAAWyF,SAAhC,CAAtB;AACA,YAAIzJ,KAAK,GAAG;AACVwH,UAAAA,MAAM,EAAE,KAAKP,KAAL,CAAWO,MADT;AAEVjC,UAAAA,GAAG,EAAE,KAAK0B,KAAL,CAAW1B,GAFN;AAGVmE,UAAAA,MAAM,EAAE,KAAKzC,KAAL,CAAWI,eAHT;AAIV5B,UAAAA,YAAY,EAAE,KAAKA;AAJT,SAAZ;AAMA,eAAO9E,MAAM,CAAC,SAAD,CAAN,CAAkBgJ,aAAlB,CAAgCxJ,WAAW,CAACyJ,QAA5C,EAAsD;AAC3D5J,UAAAA,KAAK,EAAEA;AADoD,SAAtD,EAEJW,MAAM,CAAC,SAAD,CAAN,CAAkBgJ,aAAlB,CAAgCzD,OAAhC,EAAyClC,KAAzC,CAFI,CAAP;AAGD;AAfA,KA7GkB,CAAT,CAAZ;;AA+HA,WAAOmC,MAAP;AACD,GApKD,CAoKExF,MAAM,CAAC,SAAD,CAAN,CAAkBkJ,SApKpB,CAFO,EAsKyB1D,MAAM,CAAC2D,WAAP,GAAqB,eAtK9C,EAsK+D3D,MAAM,CAAC4D,SAAP;AACtE;AACA;AACE;;;;;;AAMAN,IAAAA,SAAS,EAAE/I,UAAU,CAAC,SAAD,CAAV,CAAsBsJ,MAPnC;;AASE;;;;;;;;AAQAxC,IAAAA,MAAM,EAAE9G,UAAU,CAAC,SAAD,CAAV,CAAsBsJ;AAjBhC,GAxKO,EA0LJ7D,MAAM,CAAC8D,iBAAP,GAA2B7J,YA1LvB,EA0LqCgG,KA1L5C;AA2LD,CA5MmB,CAApB;AA6MArG,OAAO,CAACE,aAAR,GAAwBA,aAAxB;AACA,IAAIiK,oBAAoB,GAAG;AACzBC,EAAAA,UAAU,EAAE,IADa;AAEzBC,EAAAA,OAAO,EAAE,IAFgB;AAGzBC,EAAAA,gBAAgB,EAAE;AAHO,CAA3B;AAKA,IAAInK,oBAAoB,GAAG,CAAC,GAAGK,IAAI,CAAC,SAAD,CAAR,EAAqB2J,oBAArB,EAA2C,UAAUjE,MAAV,EAAkBC,OAAlB,EAA2B;AAC/F,MAAIoE,UAAU,GAAGrE,MAAM,CAACqE,UAAxB;AAAA,MACIH,UAAU,GAAGlE,MAAM,CAACkE,UADxB;AAAA,MAEIC,OAAO,GAAGnE,MAAM,CAACmE,OAFrB;AAAA,MAGIC,gBAAgB,GAAGpE,MAAM,CAACoE,gBAH9B,CAD+F,CAI/C;;AAEhD,SAAO,SAASnK,oBAAT,CAA8B8D,KAA9B,EAAqC;AAC1C,WAAOrD,MAAM,CAAC,SAAD,CAAN,CAAkBgJ,aAAlB,CAAgCxJ,WAAW,CAACoK,QAA5C,EAAsD,IAAtD,EAA4D,UAAUC,WAAV,EAAuB;AACxF,UAAIA,WAAJ,EAAiB;AACf,YAAId,MAAM,GAAGc,WAAW,CAACd,MAAzB;AAAA,YACIlC,MAAM,GAAGgD,WAAW,CAAChD,MADzB;AAAA,YAEIjC,GAAG,GAAGiF,WAAW,CAACjF,GAFtB;AAAA,YAGIkF,MAAM,GAAGD,WAAW,CAAC/E,YAHzB;AAIAzB,QAAAA,KAAK,GAAGnE,MAAM,CAAC2J,MAAP,CAAc,EAAd,EAAkBxF,KAAlB,CAAR;;AAEA,YAAIsG,UAAJ,EAAgB;AACdtG,UAAAA,KAAK,CAACsG,UAAD,CAAL,GAAoBZ,MAApB;AACD;;AAED,YAAIS,UAAJ,EAAgB;AACdnG,UAAAA,KAAK,CAACmG,UAAD,CAAL,GAAoB3C,MAApB;AACD;;AAED,YAAI4C,OAAJ,EAAa;AACXpG,UAAAA,KAAK,CAACoG,OAAD,CAAL,GAAiB7E,GAAjB;AACD;;AAED,YAAI8E,gBAAJ,EAAsB;AACpBrG,UAAAA,KAAK,CAACqG,gBAAD,CAAL,GAA0BI,MAA1B;AACD;AACF;;AAED,aAAO9J,MAAM,CAAC,SAAD,CAAN,CAAkBgJ,aAAlB,CAAgCzD,OAAhC,EAAyClC,KAAzC,CAAP;AACD,KA1BM,CAAP;AA2BD,GA5BD;AA6BD,CAnC0B,CAA3B;AAoCAjE,OAAO,CAACG,oBAAR,GAA+BA,oBAA/B;AACA,IAAIwK,QAAQ,GAAGzK,aAAf;AACAF,OAAO,CAAC,SAAD,CAAP,GAAqB2K,QAArB","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.I18nDecorator = exports.I18nContextDecorator = exports.I18nContext = exports.contextTypes = exports[\"default\"] = void 0;\n\nvar _dispatcher = require(\"@enact/core/dispatcher\");\n\nvar _hoc = _interopRequireDefault(require(\"@enact/core/hoc\"));\n\nvar _util = require(\"@enact/core/util\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _locale = require(\"../locale\");\n\nvar _index = _interopRequireDefault(require(\"../src/index.js\"));\n\nvar _resBundle = require(\"../src/resBundle\");\n\nvar _wrapIlibCallback = _interopRequireDefault(require(\"../src/wrapIlibCallback\"));\n\nvar _getI18nClasses = _interopRequireDefault(require(\"./getI18nClasses\"));\n\nvar _windowFocus = require(\"./windowFocus\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nvar join = function join(a, b) {\n  return a && b ? a + ' ' + b : a || b || '';\n};\n\nvar contextTypes = {\n  rtl: _propTypes[\"default\"].bool,\n  updateLocale: _propTypes[\"default\"].func\n};\nexports.contextTypes = contextTypes;\n\nvar I18nContext = _react[\"default\"].createContext(null);\n/**\n * Default config for `I18nDecorator`.\n *\n * @memberof i18n/I18nDecorator.I18nDecorator\n * @hocconfig\n */\n\n\nexports.I18nContext = I18nContext;\nvar defaultConfig = {\n  /**\n   * Array of locales that should be treated as latin regardless of their script.\n   *\n   * @type {String[]}\n   * @default\tnull\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  latinLanguageOverrides: null,\n\n  /**\n   * Array of locales that should be treated as non-latin regardless of their script.\n   *\n   * @type {String[]}\n   * @default null\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  nonLatinLanguageOverrides: null,\n\n  /**\n   * Array of resource loaders to be invoked after a locale change.\n   *\n   * Each loader must be a function which accepts an object and returns either the resource when\n   * `options.sync` is `true` or a `Promise` for the resource when `options.sync` is `false`.\n   *\n   * ```\n   * resources: [\n   *   (options) => new Promise((resolve, reject) => {\n   *     fetchResource({onLoad: resolve, onError: reject});\n   *   })\n   * ]\n   * ```\n   *\n   * If you need to handle the resource in some way on load, you can pass an object with an\n   * `onLoad` member that will be called once all resources have been loaded. This should be used\n   * if loading a resource has side effects that should only be applied once all loading has\n   * completed.\n   *\n   * ```\n   * resources: [\n   *   {resource: (options) => { ... fetch ... }, onLoad: (res) => { ... apply side effect ... }}\n   * ]\n   * ```\n   *\n   * @type {Array<Function|Object>}\n   * @default null\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  resources: null,\n\n  /**\n   * Retrieve i18n resource files synchronously\n   *\n   * @type {Boolean}\n   * @default false\n   * @public\n   * @memberof i18n/I18nDecorator.I18nDecorator.defaultConfig\n   */\n  sync: false\n};\n/**\n * A higher-order component that is used to wrap the root element in an app. It provides an `rtl` member on the\n * context of the wrapped component, allowing the children to check the current text directionality as well as\n * an `updateLocale` method that can be used to update the current locale.\n *\n * There are no configurable options on this HOC.\n *\n * @class I18nDecorator\n * @memberof i18n/I18nDecorator\n * @hoc\n * @public\n */\n\nvar I18nDecorator = (0, _hoc[\"default\"])(defaultConfig, function (config, Wrapped) {\n  var _class, _temp;\n\n  var latinLanguageOverrides = config.latinLanguageOverrides,\n      nonLatinLanguageOverrides = config.nonLatinLanguageOverrides,\n      sync = config.sync; // Normalize the structure of the external resources to be an array of resource/onLoad pairs\n\n  var extResources = Array.isArray(config.resources) ? config.resources.map(function (res) {\n    if (!res) return;\n    var fn = res.resource || res;\n    var onLoad = res.onLoad;\n    if (typeof fn !== 'function') return;\n    return {\n      resource: fn,\n      onLoad: onLoad\n    };\n  }).filter(Boolean) : [];\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_React$Component) {\n    _inherits(_class, _React$Component);\n\n    function _class(props) {\n      var _this;\n\n      _classCallCheck(this, _class);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(_class).call(this, props));\n\n      _this.handleLocaleChange = function () {\n        (0, _windowFocus.onWindowFocus)(_this.updateLocale);\n      };\n\n      _this.updateLocale = function (newLocale) {\n        var state = _this.getDerivedStateForLocale(newLocale);\n\n        if (sync) {\n          _this.setState(state);\n        } else {\n          _this.loadResources(newLocale);\n\n          _this.setState({\n            resourcesLoaded: false\n          });\n        }\n      };\n\n      var ilibLocale = _index[\"default\"].getLocale();\n\n      var locale = props.locale && props.locale !== ilibLocale ? props.locale : ilibLocale;\n      _this.loadResourceJob = new _util.Job(_this.setState.bind(_assertThisInitialized(_this)));\n      _this.state = _this.getDerivedStateForLocale(locale);\n      return _this;\n    }\n\n    _createClass(_class, [{\n      key: \"getChildContext\",\n      value: function getChildContext() {\n        return {\n          rtl: this.state.rtl,\n          updateLocale: this.updateLocale\n        };\n      }\n    }, {\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object') {\n          (0, _dispatcher.on)('languagechange', this.handleLocaleChange, window);\n        }\n\n        if (!sync) {\n          this.loadResources(this.state.locale);\n        }\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate(prevProps) {\n        if (this.props.locale !== prevProps.locale) {\n          var state = this.getDerivedStateForLocale(this.props.locale);\n\n          if (sync) {\n            // eslint-disable-next-line react/no-did-update-set-state\n            this.setState(state);\n          } else {\n            this.loadResources(this.props.locale);\n          }\n        }\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        this.loadResourceJob.stop();\n\n        if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object') {\n          (0, _dispatcher.off)('languagechange', this.handleLocaleChange, window);\n        }\n      }\n    }, {\n      key: \"getDerivedStateForLocale\",\n      value: function getDerivedStateForLocale(spec) {\n        var locale = (0, _locale.updateLocale)(spec);\n        var state = {\n          locale: locale,\n          resourcesLoaded: sync\n        };\n\n        if (sync) {\n          var options = {\n            locale: locale,\n            sync: sync\n          };\n          state.rtl = (0, _wrapIlibCallback[\"default\"])(_locale.isRtlLocale, options);\n          state.classes = (0, _wrapIlibCallback[\"default\"])(_getI18nClasses[\"default\"], _objectSpread({}, options, {\n            latinLanguageOverrides: latinLanguageOverrides,\n            nonLatinLanguageOverrides: nonLatinLanguageOverrides\n          }));\n          var bundle = (0, _wrapIlibCallback[\"default\"])(_resBundle.createResBundle, options);\n          (0, _resBundle.setResBundle)(bundle);\n          extResources.forEach(function (_ref) {\n            var resource = _ref.resource,\n                onLoad = _ref.onLoad;\n            var result = resource(options);\n            if (onLoad) onLoad(result);\n          });\n        }\n\n        return state;\n      }\n    }, {\n      key: \"loadResources\",\n      value: function loadResources(locale) {\n        var options = {\n          sync: sync,\n          locale: locale\n        };\n        var resources = Promise.all([(0, _wrapIlibCallback[\"default\"])(_locale.isRtlLocale, options), (0, _wrapIlibCallback[\"default\"])(_getI18nClasses[\"default\"], _objectSpread({}, options, {\n          latinLanguageOverrides: latinLanguageOverrides,\n          nonLatinLanguageOverrides: nonLatinLanguageOverrides\n        })), // move updating into a new method with call to setState\n        (0, _wrapIlibCallback[\"default\"])(_resBundle.createResBundle, options)].concat(_toConsumableArray(extResources.map(function (res) {\n          return (0, _wrapIlibCallback[\"default\"])(res.resource, options);\n        })))).then(function (_ref2) {\n          var _ref3 = _toArray(_ref2),\n              rtl = _ref3[0],\n              classes = _ref3[1],\n              bundle = _ref3[2],\n              userResources = _ref3.slice(3);\n\n          (0, _resBundle.setResBundle)(bundle);\n          extResources.forEach(function (_ref4, i) {\n            var onLoad = _ref4.onLoad;\n            return onLoad && onLoad(userResources[i]);\n          });\n          return {\n            locale: locale,\n            classes: classes,\n            rtl: rtl,\n            resourcesLoaded: true\n          };\n        }); // TODO: Resolve how to handle failed resource resquests\n        // .catch(...);\n\n        this.loadResourceJob.promise(resources);\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var props = Object.assign({}, this.props);\n        delete props.locale;\n        props.className = join(this.state.classes, this.props.className);\n        var value = {\n          locale: this.state.locale,\n          rtl: this.state.rtl,\n          loaded: this.state.resourcesLoaded,\n          updateLocale: this.updateLocale\n        };\n        return _react[\"default\"].createElement(I18nContext.Provider, {\n          value: value\n        }, _react[\"default\"].createElement(Wrapped, props));\n      }\n    }]);\n\n    return _class;\n  }(_react[\"default\"].Component), _class.displayName = 'I18nDecorator', _class.propTypes =\n  /** @lends i18n/I18nDecorator.I18nDecorator.prototype */\n  {\n    /**\n     * Classname for a root app element.\n     *\n     * @type {String}\n     * @public\n     */\n    className: _propTypes[\"default\"].string,\n\n    /**\n     * A string with a {@link https://tools.ietf.org/html/rfc5646|BCP 47 language tag}.\n     *\n     * The system locale will be used by default.\n     *\n     * @type {String}\n     * @public\n     */\n    locale: _propTypes[\"default\"].string\n  }, _class.childContextTypes = contextTypes, _temp;\n});\nexports.I18nDecorator = I18nDecorator;\nvar contextDefaultConfig = {\n  localeProp: null,\n  rtlProp: null,\n  updateLocaleProp: null\n};\nvar I18nContextDecorator = (0, _hoc[\"default\"])(contextDefaultConfig, function (config, Wrapped) {\n  var loadedProp = config.loadedProp,\n      localeProp = config.localeProp,\n      rtlProp = config.rtlProp,\n      updateLocaleProp = config.updateLocaleProp; // eslint-disable-next-line no-shadow\n\n  return function I18nContextDecorator(props) {\n    return _react[\"default\"].createElement(I18nContext.Consumer, null, function (i18nContext) {\n      if (i18nContext) {\n        var loaded = i18nContext.loaded,\n            locale = i18nContext.locale,\n            rtl = i18nContext.rtl,\n            update = i18nContext.updateLocale;\n        props = Object.assign({}, props);\n\n        if (loadedProp) {\n          props[loadedProp] = loaded;\n        }\n\n        if (localeProp) {\n          props[localeProp] = locale;\n        }\n\n        if (rtlProp) {\n          props[rtlProp] = rtl;\n        }\n\n        if (updateLocaleProp) {\n          props[updateLocaleProp] = update;\n        }\n      }\n\n      return _react[\"default\"].createElement(Wrapped, props);\n    });\n  };\n});\nexports.I18nContextDecorator = I18nContextDecorator;\nvar _default = I18nDecorator;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"module"}