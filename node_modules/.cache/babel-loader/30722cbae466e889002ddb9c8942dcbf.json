{"ast":null,"code":"\"use strict\";\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Loader = EnyoLoader;\nexports[\"default\"] = void 0;\n\nvar _util = require(\"@enact/core/util\");\n\nvar _xhr = _interopRequireDefault(require(\"xhr\"));\n\nvar _Loader = _interopRequireDefault(require(\"../ilib/lib/Loader\"));\n\nvar _LocaleInfo = _interopRequireDefault(require(\"../ilib/lib/LocaleInfo\"));\n\nvar _zoneinfo = _interopRequireDefault(require(\"./zoneinfo\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar getImpl = function getImpl(url, callback, sync) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    _xhr[\"default\"].XMLHttpRequest = XMLHttpRequest || _xhr[\"default\"].XMLHttpRequest;\n    var req;\n    (0, _xhr[\"default\"])({\n      url: url,\n      sync: sync,\n      beforeSend: function beforeSend(r) {\n        return req = r;\n      }\n    }, function (err, resp, body) {\n      var error = err || resp.statusCode !== 200 && resp.statusCode; // false failure from chrome and file:// urls\n\n      if (error && req.status === 0 && req.response.length > 0) {\n        body = req.response;\n        error = false;\n      }\n\n      var json = null;\n\n      try {\n        json = error ? null : JSON.parse(body);\n      } catch (e) {\n        error = 'Failed to parse ILIB JSON data';\n      }\n\n      callback(json, error);\n    });\n  } else {\n    callback(null, new Error('Not a web browser environment'));\n  }\n};\n\nvar getSync = function getSync(url, callback) {\n  return getImpl(url, callback, true);\n};\n\nvar get = (0, _util.memoize)(function (url) {\n  return new Promise(function (resolve, reject) {\n    getImpl(url, function (json, error) {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(json);\n      }\n    }, false);\n  });\n});\nvar iLibBase = typeof ILIB_BASE_PATH === 'undefined' ? '/ilib' : ILIB_BASE_PATH;\nvar iLibResources = typeof ILIB_RESOURCES_PATH === 'undefined' ? '/locale' : ILIB_RESOURCES_PATH;\nvar cachePrefix = 'ENACT-ILIB-';\nvar cacheKey = cachePrefix + 'CACHE-ID';\nvar cacheID = typeof ILIB_CACHE_ID === 'undefined' ? '$ILIB' : ILIB_CACHE_ID;\n\nfunction EnyoLoader() {\n  this.base = iLibBase; // TODO: full enyo.platform implementation for improved accuracy\n\n  if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object' && _typeof(window.PalmSystem) === 'object') {\n    this.webos = true;\n  }\n}\n\nEnyoLoader.prototype = new _Loader[\"default\"]();\nEnyoLoader.prototype.constructor = EnyoLoader;\n\nEnyoLoader.prototype._createZoneFile = function (path) {\n  var zone = path.substring(path.indexOf('zoneinfo')); // remove the .json suffix to get the name of the zone\n\n  zone = zone.substring(0, zone.length - 5);\n\n  try {\n    var zif = new _zoneinfo[\"default\"]('/usr/share/' + zone); // only get the info for this year. Later we can get the info\n    // for any historical or future year too\n\n    return zif.getIlibZoneInfo(new Date());\n  } catch (e) {// no file, so just return nothing\n  }\n};\n\nEnyoLoader.prototype._pathjoin = function (_root, subpath) {\n  if (!_root || !_root.length) {\n    return subpath;\n  }\n\n  if (!subpath || !subpath.length) {\n    return _root;\n  }\n\n  return _root + (_root.charAt(_root.length - 1) !== '/' ? '/' : '') + subpath;\n};\n/**\n * Load the list of files asynchronously. This uses recursion in\n * order to create a queue of files that will be loaded serially.\n * Each layer, starting at the bottom, loads a file and then loads\n * the layer on top of it. The very top file on the stack will have\n * zero files to load, so instead it will be the one to call the\n * callback to notify the caller that all the content is loaded.\n *\n * @param {Array.<string>} paths array of strings containing relative paths for required locale data\n *\tfiles\n * @param {Array} results empty array in which to place the resulting json when it is loaded from a\n *\tfile\n * @param {Object} params An object full of parameters that the caller is passing to this function\n *\tto help load the files\n * @param {function(Array.<Object>)} callback callback to call when this function is finished\n *\tattempting to load all the files that exist and can be loaded\n *\n * @returns {Promise}\n */\n\n\nEnyoLoader.prototype._loadFilesAsync = function (path, params, cache) {\n  var _this = this;\n\n  var _root = iLibResources;\n\n  if (params && typeof params.root !== 'undefined') {\n    _root = params.root;\n  }\n\n  var cacheItem = cache.data.shift(),\n      url;\n\n  if (this.webos && path.indexOf('zoneinfo') !== -1) {\n    // TODO: Sort out async zone file loading\n    return this._createZoneFile(path);\n  } else if (cacheItem) {\n    return Promise.resolve(cacheItem);\n  }\n\n  return this.loadManifests(_root).then(function () {\n    var isRootAvailable = _this.isAvailable(_root, path);\n\n    if (isRootAvailable) {\n      url = _this._pathjoin(_root, path);\n    } else {\n      var localeBase = _this._pathjoin(_this.base, 'locale');\n\n      var isBaseAvailable = _this.isAvailable(localeBase, path);\n\n      if (isBaseAvailable) {\n        url = _this._pathjoin(localeBase, path);\n      }\n    }\n\n    if (url) {\n      return get(url).then(function (json) {\n        if (_typeof(json) === 'object') {\n          cache.update = true;\n          return json;\n        } else if (path === 'localeinfo.json') {\n          return _LocaleInfo[\"default\"].defaultInfo;\n        }\n      });\n    }\n\n    return null;\n  });\n};\n\nEnyoLoader.prototype._loadFilesCache = function (_root, paths) {\n  this._validateCache();\n\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var stored = window.localStorage.getItem(cachePrefix + _root + '/' + paths[0]);\n\n    if (stored) {\n      var target = JSON.stringify(paths);\n      var data = JSON.parse(stored);\n\n      if (data.target === target) {\n        return data.value;\n      } else {\n        window.localStorage.removeItem(cachePrefix + _root + '/' + paths[0]);\n      }\n    }\n  }\n\n  return new Array(paths.length);\n};\n\nEnyoLoader.prototype._storeFilesCache = function (_root, paths, data) {\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var target = JSON.stringify(paths);\n    window.localStorage.setItem(cachePrefix + _root + '/' + paths[0], JSON.stringify({\n      target: target,\n      value: data\n    }));\n  }\n};\n\nEnyoLoader.prototype._validateCache = function () {\n  if (!this._cacheValidated && typeof window !== 'undefined' && window.localStorage) {\n    var activeID = window.localStorage.getItem(cacheKey);\n\n    if (activeID !== cacheID) {\n      for (var i = 0; i < window.localStorage.length; i++) {\n        var key = window.localStorage.key(i);\n\n        if (key.indexOf(cachePrefix) === 0) {\n          window.localStorage.removeItem(key);\n          i--;\n        }\n      }\n\n      window.localStorage.setItem(cacheKey, cacheID);\n    }\n  }\n\n  this._cacheValidated = true;\n};\n\nEnyoLoader.prototype.loadFiles = function (paths, sync, params, callback) {\n  var _this2 = this;\n\n  var _root = params && typeof params.root !== 'undefined' ? params.root : iLibResources;\n\n  var cache = {\n    data: this._loadFilesCache(_root, paths)\n  };\n\n  if (sync) {\n    var ret = [];\n\n    var locdata = this._pathjoin(this.base, 'locale'); // synchronous\n\n\n    paths.forEach(function (path, index) {\n      if (this.webos && path.indexOf('zoneinfo') !== -1) {\n        ret.push(this._createZoneFile(path));\n      } else if (cache.data[index]) {\n        ret.push(cache.data[index]);\n      } else {\n        var found = false;\n\n        var handler = function handler(json, err) {\n          if (!err && _typeof(json) === 'object') {\n            cache.update = true;\n            ret.push(json);\n            found = true;\n          }\n        };\n\n        this.loadManifestsSync(_root);\n\n        if (this.isAvailable(_root, path)) {\n          getSync(this._pathjoin(_root, path), handler);\n        }\n\n        if (!found && this.isAvailable(locdata, path)) {\n          getSync(this._pathjoin(locdata, path), handler);\n        }\n\n        if (!found) {\n          if (path === 'localeinfo.json') {\n            // Use default locale info when xhr on root localeinfo.json fails/skips\n            ret.push(_LocaleInfo[\"default\"].defaultInfo);\n          } else {\n            // not there, so fill in a blank entry in the array\n            // eslint-disable-next-line no-undefined\n            ret.push(undefined);\n          }\n        }\n      }\n    }.bind(this));\n\n    if (cache.update) {\n      this._storeFilesCache(_root, paths, ret);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(this, ret);\n    }\n\n    return ret;\n  } // asynchronous\n\n\n  Promise.all(paths.map(function (path) {\n    return _this2._loadFilesAsync(path, params, cache);\n  })).then(function (results) {\n    if (cache.update) {\n      _this2._storeFilesCache(_root, paths, results);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(_this2, results);\n    }\n  });\n};\n\nEnyoLoader.prototype._handleManifest = function (dirpath, filepath, json) {\n  // star indicates there was no ilibmanifest.json, so always try to load files from\n  // that dir\n  if (json != null) {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(cachePrefix + filepath, JSON.stringify(json));\n    }\n\n    this.manifest[dirpath] = json.files;\n  } else {\n    this.manifest[dirpath] = '*';\n  }\n\n  return this.manifest[dirpath];\n};\n\nEnyoLoader.prototype._loadManifest = function (_root, subpath, sync) {\n  var _this3 = this;\n\n  if (!this.manifest) {\n    this.manifest = {};\n  }\n\n  var dirpath = this._pathjoin(_root, subpath);\n\n  var filepath = this._pathjoin(dirpath, 'ilibmanifest.json');\n\n  if (this.manifest[dirpath]) {\n    return;\n  }\n\n  var cachedManifest;\n\n  if (typeof window !== 'undefined' && window.localStorage) {\n    cachedManifest = window.localStorage.getItem(cachePrefix + filepath);\n  }\n\n  if (cachedManifest) {\n    this.manifest[dirpath] = JSON.parse(cachedManifest).files;\n    return sync ? this.manifest[dirpath] : Promise.resolve(this.manifest[dirpath]);\n  }\n\n  if (sync) {\n    getSync(filepath, function (json) {\n      _this3._handleManifest(dirpath, filepath, json);\n    });\n    return;\n  }\n\n  return get(filepath).then(function (json) {\n    return _this3._handleManifest(dirpath, filepath, json);\n  });\n};\n\nEnyoLoader.prototype.loadManifests = function (_root) {\n  this._validateCache();\n\n  return Promise.all([// standard ilib locale data\n  this._loadManifest(this.base, 'locale'), // the app's resources dir\n  this._loadManifest('', iLibResources), // maybe it's a custom root? If so, try to load\n  // the manifest file first in case it is there\n  this._loadManifest(_root, '')]);\n};\n\nEnyoLoader.prototype.loadManifestsSync = function (_root) {\n  // load standard manifests\n  if (!this.manifest) {\n    this._validateCache();\n\n    this._loadManifest(this.base, 'locale', true); // standard ilib locale data\n\n\n    this._loadManifest('', iLibResources, true); // the app's resources dir\n\n  }\n\n  if (!this.manifest[_root]) {\n    // maybe it's a custom root? If so, try to load\n    // the manifest file first in case it is there\n    this._loadManifest(_root, '', true);\n  }\n};\n\nEnyoLoader.prototype.isAvailable = function (_root, path) {\n  // util.print('enyo loader: isAvailable ' + path + '? ');\n  // star means attempt to load everything because there was no manifest in that dir\n  if (this.manifest[_root] === '*' || this.manifest[_root].indexOf(path) !== -1) {\n    // util.print('true\\n');\n    return true;\n  } // util.print('false\\n');\n\n\n  return false;\n};\n\nvar _default = EnyoLoader;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["F:\\books\\vscode\\enact\\final\\SteAPp\\node_modules\\@enact\\i18n\\src\\Loader.js"],"names":["Object","defineProperty","exports","value","Loader","EnyoLoader","_util","require","_xhr","_interopRequireDefault","_Loader","_LocaleInfo","_zoneinfo","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","getImpl","url","callback","sync","XMLHttpRequest","req","beforeSend","r","err","resp","body","error","statusCode","status","response","length","json","JSON","parse","e","Error","getSync","get","memoize","Promise","resolve","reject","iLibBase","ILIB_BASE_PATH","iLibResources","ILIB_RESOURCES_PATH","cachePrefix","cacheKey","cacheID","ILIB_CACHE_ID","base","window","PalmSystem","webos","_createZoneFile","path","zone","substring","indexOf","zif","getIlibZoneInfo","Date","_pathjoin","_root","subpath","charAt","_loadFilesAsync","params","cache","_this","root","cacheItem","data","shift","loadManifests","then","isRootAvailable","isAvailable","localeBase","isBaseAvailable","update","defaultInfo","_loadFilesCache","paths","_validateCache","localStorage","stored","getItem","target","stringify","removeItem","Array","_storeFilesCache","setItem","_cacheValidated","activeID","i","key","loadFiles","_this2","ret","locdata","forEach","index","push","found","handler","loadManifestsSync","undefined","bind","call","all","map","results","_handleManifest","dirpath","filepath","manifest","files","_loadManifest","_this3","cachedManifest","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Loader = EnyoLoader;\nexports[\"default\"] = void 0;\n\nvar _util = require(\"@enact/core/util\");\n\nvar _xhr = _interopRequireDefault(require(\"xhr\"));\n\nvar _Loader = _interopRequireDefault(require(\"../ilib/lib/Loader\"));\n\nvar _LocaleInfo = _interopRequireDefault(require(\"../ilib/lib/LocaleInfo\"));\n\nvar _zoneinfo = _interopRequireDefault(require(\"./zoneinfo\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar getImpl = function getImpl(url, callback, sync) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    _xhr[\"default\"].XMLHttpRequest = XMLHttpRequest || _xhr[\"default\"].XMLHttpRequest;\n    var req;\n    (0, _xhr[\"default\"])({\n      url: url,\n      sync: sync,\n      beforeSend: function beforeSend(r) {\n        return req = r;\n      }\n    }, function (err, resp, body) {\n      var error = err || resp.statusCode !== 200 && resp.statusCode; // false failure from chrome and file:// urls\n\n      if (error && req.status === 0 && req.response.length > 0) {\n        body = req.response;\n        error = false;\n      }\n\n      var json = null;\n\n      try {\n        json = error ? null : JSON.parse(body);\n      } catch (e) {\n        error = 'Failed to parse ILIB JSON data';\n      }\n\n      callback(json, error);\n    });\n  } else {\n    callback(null, new Error('Not a web browser environment'));\n  }\n};\n\nvar getSync = function getSync(url, callback) {\n  return getImpl(url, callback, true);\n};\n\nvar get = (0, _util.memoize)(function (url) {\n  return new Promise(function (resolve, reject) {\n    getImpl(url, function (json, error) {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(json);\n      }\n    }, false);\n  });\n});\nvar iLibBase = typeof ILIB_BASE_PATH === 'undefined' ? '/ilib' : ILIB_BASE_PATH;\nvar iLibResources = typeof ILIB_RESOURCES_PATH === 'undefined' ? '/locale' : ILIB_RESOURCES_PATH;\nvar cachePrefix = 'ENACT-ILIB-';\nvar cacheKey = cachePrefix + 'CACHE-ID';\nvar cacheID = typeof ILIB_CACHE_ID === 'undefined' ? '$ILIB' : ILIB_CACHE_ID;\n\nfunction EnyoLoader() {\n  this.base = iLibBase; // TODO: full enyo.platform implementation for improved accuracy\n\n  if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === 'object' && _typeof(window.PalmSystem) === 'object') {\n    this.webos = true;\n  }\n}\n\nEnyoLoader.prototype = new _Loader[\"default\"]();\nEnyoLoader.prototype.constructor = EnyoLoader;\n\nEnyoLoader.prototype._createZoneFile = function (path) {\n  var zone = path.substring(path.indexOf('zoneinfo')); // remove the .json suffix to get the name of the zone\n\n  zone = zone.substring(0, zone.length - 5);\n\n  try {\n    var zif = new _zoneinfo[\"default\"]('/usr/share/' + zone); // only get the info for this year. Later we can get the info\n    // for any historical or future year too\n\n    return zif.getIlibZoneInfo(new Date());\n  } catch (e) {// no file, so just return nothing\n  }\n};\n\nEnyoLoader.prototype._pathjoin = function (_root, subpath) {\n  if (!_root || !_root.length) {\n    return subpath;\n  }\n\n  if (!subpath || !subpath.length) {\n    return _root;\n  }\n\n  return _root + (_root.charAt(_root.length - 1) !== '/' ? '/' : '') + subpath;\n};\n/**\n * Load the list of files asynchronously. This uses recursion in\n * order to create a queue of files that will be loaded serially.\n * Each layer, starting at the bottom, loads a file and then loads\n * the layer on top of it. The very top file on the stack will have\n * zero files to load, so instead it will be the one to call the\n * callback to notify the caller that all the content is loaded.\n *\n * @param {Array.<string>} paths array of strings containing relative paths for required locale data\n *\tfiles\n * @param {Array} results empty array in which to place the resulting json when it is loaded from a\n *\tfile\n * @param {Object} params An object full of parameters that the caller is passing to this function\n *\tto help load the files\n * @param {function(Array.<Object>)} callback callback to call when this function is finished\n *\tattempting to load all the files that exist and can be loaded\n *\n * @returns {Promise}\n */\n\n\nEnyoLoader.prototype._loadFilesAsync = function (path, params, cache) {\n  var _this = this;\n\n  var _root = iLibResources;\n\n  if (params && typeof params.root !== 'undefined') {\n    _root = params.root;\n  }\n\n  var cacheItem = cache.data.shift(),\n      url;\n\n  if (this.webos && path.indexOf('zoneinfo') !== -1) {\n    // TODO: Sort out async zone file loading\n    return this._createZoneFile(path);\n  } else if (cacheItem) {\n    return Promise.resolve(cacheItem);\n  }\n\n  return this.loadManifests(_root).then(function () {\n    var isRootAvailable = _this.isAvailable(_root, path);\n\n    if (isRootAvailable) {\n      url = _this._pathjoin(_root, path);\n    } else {\n      var localeBase = _this._pathjoin(_this.base, 'locale');\n\n      var isBaseAvailable = _this.isAvailable(localeBase, path);\n\n      if (isBaseAvailable) {\n        url = _this._pathjoin(localeBase, path);\n      }\n    }\n\n    if (url) {\n      return get(url).then(function (json) {\n        if (_typeof(json) === 'object') {\n          cache.update = true;\n          return json;\n        } else if (path === 'localeinfo.json') {\n          return _LocaleInfo[\"default\"].defaultInfo;\n        }\n      });\n    }\n\n    return null;\n  });\n};\n\nEnyoLoader.prototype._loadFilesCache = function (_root, paths) {\n  this._validateCache();\n\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var stored = window.localStorage.getItem(cachePrefix + _root + '/' + paths[0]);\n\n    if (stored) {\n      var target = JSON.stringify(paths);\n      var data = JSON.parse(stored);\n\n      if (data.target === target) {\n        return data.value;\n      } else {\n        window.localStorage.removeItem(cachePrefix + _root + '/' + paths[0]);\n      }\n    }\n  }\n\n  return new Array(paths.length);\n};\n\nEnyoLoader.prototype._storeFilesCache = function (_root, paths, data) {\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var target = JSON.stringify(paths);\n    window.localStorage.setItem(cachePrefix + _root + '/' + paths[0], JSON.stringify({\n      target: target,\n      value: data\n    }));\n  }\n};\n\nEnyoLoader.prototype._validateCache = function () {\n  if (!this._cacheValidated && typeof window !== 'undefined' && window.localStorage) {\n    var activeID = window.localStorage.getItem(cacheKey);\n\n    if (activeID !== cacheID) {\n      for (var i = 0; i < window.localStorage.length; i++) {\n        var key = window.localStorage.key(i);\n\n        if (key.indexOf(cachePrefix) === 0) {\n          window.localStorage.removeItem(key);\n          i--;\n        }\n      }\n\n      window.localStorage.setItem(cacheKey, cacheID);\n    }\n  }\n\n  this._cacheValidated = true;\n};\n\nEnyoLoader.prototype.loadFiles = function (paths, sync, params, callback) {\n  var _this2 = this;\n\n  var _root = params && typeof params.root !== 'undefined' ? params.root : iLibResources;\n\n  var cache = {\n    data: this._loadFilesCache(_root, paths)\n  };\n\n  if (sync) {\n    var ret = [];\n\n    var locdata = this._pathjoin(this.base, 'locale'); // synchronous\n\n\n    paths.forEach(function (path, index) {\n      if (this.webos && path.indexOf('zoneinfo') !== -1) {\n        ret.push(this._createZoneFile(path));\n      } else if (cache.data[index]) {\n        ret.push(cache.data[index]);\n      } else {\n        var found = false;\n\n        var handler = function handler(json, err) {\n          if (!err && _typeof(json) === 'object') {\n            cache.update = true;\n            ret.push(json);\n            found = true;\n          }\n        };\n\n        this.loadManifestsSync(_root);\n\n        if (this.isAvailable(_root, path)) {\n          getSync(this._pathjoin(_root, path), handler);\n        }\n\n        if (!found && this.isAvailable(locdata, path)) {\n          getSync(this._pathjoin(locdata, path), handler);\n        }\n\n        if (!found) {\n          if (path === 'localeinfo.json') {\n            // Use default locale info when xhr on root localeinfo.json fails/skips\n            ret.push(_LocaleInfo[\"default\"].defaultInfo);\n          } else {\n            // not there, so fill in a blank entry in the array\n            // eslint-disable-next-line no-undefined\n            ret.push(undefined);\n          }\n        }\n      }\n    }.bind(this));\n\n    if (cache.update) {\n      this._storeFilesCache(_root, paths, ret);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(this, ret);\n    }\n\n    return ret;\n  } // asynchronous\n\n\n  Promise.all(paths.map(function (path) {\n    return _this2._loadFilesAsync(path, params, cache);\n  })).then(function (results) {\n    if (cache.update) {\n      _this2._storeFilesCache(_root, paths, results);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(_this2, results);\n    }\n  });\n};\n\nEnyoLoader.prototype._handleManifest = function (dirpath, filepath, json) {\n  // star indicates there was no ilibmanifest.json, so always try to load files from\n  // that dir\n  if (json != null) {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(cachePrefix + filepath, JSON.stringify(json));\n    }\n\n    this.manifest[dirpath] = json.files;\n  } else {\n    this.manifest[dirpath] = '*';\n  }\n\n  return this.manifest[dirpath];\n};\n\nEnyoLoader.prototype._loadManifest = function (_root, subpath, sync) {\n  var _this3 = this;\n\n  if (!this.manifest) {\n    this.manifest = {};\n  }\n\n  var dirpath = this._pathjoin(_root, subpath);\n\n  var filepath = this._pathjoin(dirpath, 'ilibmanifest.json');\n\n  if (this.manifest[dirpath]) {\n    return;\n  }\n\n  var cachedManifest;\n\n  if (typeof window !== 'undefined' && window.localStorage) {\n    cachedManifest = window.localStorage.getItem(cachePrefix + filepath);\n  }\n\n  if (cachedManifest) {\n    this.manifest[dirpath] = JSON.parse(cachedManifest).files;\n    return sync ? this.manifest[dirpath] : Promise.resolve(this.manifest[dirpath]);\n  }\n\n  if (sync) {\n    getSync(filepath, function (json) {\n      _this3._handleManifest(dirpath, filepath, json);\n    });\n    return;\n  }\n\n  return get(filepath).then(function (json) {\n    return _this3._handleManifest(dirpath, filepath, json);\n  });\n};\n\nEnyoLoader.prototype.loadManifests = function (_root) {\n  this._validateCache();\n\n  return Promise.all([// standard ilib locale data\n  this._loadManifest(this.base, 'locale'), // the app's resources dir\n  this._loadManifest('', iLibResources), // maybe it's a custom root? If so, try to load\n  // the manifest file first in case it is there\n  this._loadManifest(_root, '')]);\n};\n\nEnyoLoader.prototype.loadManifestsSync = function (_root) {\n  // load standard manifests\n  if (!this.manifest) {\n    this._validateCache();\n\n    this._loadManifest(this.base, 'locale', true); // standard ilib locale data\n\n\n    this._loadManifest('', iLibResources, true); // the app's resources dir\n\n  }\n\n  if (!this.manifest[_root]) {\n    // maybe it's a custom root? If so, try to load\n    // the manifest file first in case it is there\n    this._loadManifest(_root, '', true);\n  }\n};\n\nEnyoLoader.prototype.isAvailable = function (_root, path) {\n  // util.print('enyo loader: isAvailable ' + path + '? ');\n  // star means attempt to load everything because there was no manifest in that dir\n  if (this.manifest[_root] === '*' || this.manifest[_root].indexOf(path) !== -1) {\n    // util.print('true\\n');\n    return true;\n  } // util.print('false\\n');\n\n\n  return false;\n};\n\nvar _default = EnyoLoader;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"module"}